name: Optimize Images

on:
  # Run on PRs and pushes to main
  push:
    branches: [ main ]
    paths:
      - '**.jpg'
      - '**.jpeg'
      - '**.png'
      - '**.webp'
  pull_request:
    paths:
      - '**.jpg'
      - '**.jpeg'
      - '**.png'
      - '**.webp'
  # Allow manual triggers
  workflow_dispatch:

jobs:
  optimize:
    name: Optimize Images
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Optimize images
        uses: calibreapp/image-actions@main
        with:
          # Ignore images in node_modules and specific asset folders if needed
          ignorePaths: 'node_modules/**'
          compressOnly: true
          
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v8
        with:
          title: 'Optimize images'
          branch: optimize-images
          commit-message: 'Optimize images'
          body: |
            Image optimization completed via GitHub Actions
            - Compressed images to reduce file size while maintaining quality
            - Auto-generated by [image-actions](https://github.com/calibreapp/image-actions)
          labels: |
            automated
            image optimization